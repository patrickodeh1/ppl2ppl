<div class="password-strength-wrapper">
    <input type="password" name="{{ widget.name }}" 
           {% include "django/forms/widgets/attrs.html" %} 
           data-password-strength="true"
           id="{{ widget.attrs.id }}"
           class="form-control password-strength-input">
    
    <!-- Password Strength Indicator -->
    <div class="password-strength-indicator" style="margin-top: 0.5rem; display: none;">
        <div style="height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden; margin-bottom: 0.25rem;">
            <div class="password-strength-bar" style="height: 100%; width: 0%; transition: all 0.3s ease; background: #ef4444;"></div>
        </div>
        <small class="password-strength-text" style="font-weight: 600; color: #ef4444;">
            Weak
        </small>
    </div>
    
    <!-- Password Requirements -->
    <div class="password-requirements" style="margin-top: 0.75rem; font-size: 0.85rem;">
        <div class="requirement" style="color: #9ca3af; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
            <span class="requirement-check" style="width: 18px; height: 18px; border: 1px solid #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center;">○</span>
            <span>At least 8 characters</span>
        </div>
        <div class="requirement" style="color: #9ca3af; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
            <span class="requirement-check" style="width: 18px; height: 18px; border: 1px solid #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center;">○</span>
            <span>One uppercase letter (A-Z)</span>
        </div>
        <div class="requirement" style="color: #9ca3af; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
            <span class="requirement-check" style="width: 18px; height: 18px; border: 1px solid #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center;">○</span>
            <span>One lowercase letter (a-z)</span>
        </div>
        <div class="requirement" style="color: #9ca3af; display: flex; align-items: center; gap: 0.5rem;">
            <span class="requirement-check" style="width: 18px; height: 18px; border: 1px solid #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center;">○</span>
            <span>One number (0-9)</span>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.querySelector('[data-password-strength="true"]');
    
    if (!passwordInput) return;
    
    const strengthIndicator = passwordInput.parentElement.querySelector('.password-strength-indicator');
    const strengthBar = strengthIndicator.querySelector('.password-strength-bar');
    const strengthText = strengthIndicator.querySelector('.password-strength-text');
    const requirementsContainer = passwordInput.parentElement.querySelector('.password-requirements');
    const requirements = {
        length: requirementsContainer.querySelector('.requirement:nth-child(1)'),
        uppercase: requirementsContainer.querySelector('.requirement:nth-child(2)'),
        lowercase: requirementsContainer.querySelector('.requirement:nth-child(3)'),
        number: requirementsContainer.querySelector('.requirement:nth-child(4)')
    };
    
    function updateStrength() {
        const password = passwordInput.value;
        
        // Show indicator if password has content
        if (password.length > 0) {
            strengthIndicator.style.display = 'block';
        } else {
            strengthIndicator.style.display = 'none';
            return;
        }
        
        // Check requirements
        const hasLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasLowercase = /[a-z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        
        // Update requirement indicators
        updateRequirement(requirements.length, hasLength);
        updateRequirement(requirements.uppercase, hasUppercase);
        updateRequirement(requirements.lowercase, hasLowercase);
        updateRequirement(requirements.number, hasNumber);
        
        // Calculate strength
        let strength = 0;
        let strengthLabel = 'Weak';
        let strengthColor = '#ef4444';
        
        if (hasLength) strength++;
        if (hasUppercase) strength++;
        if (hasLowercase) strength++;
        if (hasNumber) strength++;
        
        // Add bonus for special characters
        if (/[!@#$%^&*()_+\-=\[\]{};:'",./<>?\\|`~]/.test(password)) strength++;
        
        // Determine strength level
        if (strength >= 4) {
            strengthLabel = 'Strong';
            strengthColor = '#22c55e';
        } else if (strength >= 3) {
            strengthLabel = 'Medium';
            strengthColor = '#f59e0b';
        }
        
        // Update strength bar
        const percentage = (strength / 5) * 100;
        strengthBar.style.width = percentage + '%';
        strengthBar.style.backgroundColor = strengthColor;
        
        // Update strength text
        strengthText.textContent = strengthLabel;
        strengthText.style.color = strengthColor;
    }
    
    function updateRequirement(element, met) {
        const check = element.querySelector('.requirement-check');
        if (met) {
            element.style.color = '#22c55e';
            check.textContent = '✓';
            check.style.borderColor = '#22c55e';
            check.style.color = '#22c55e';
        } else {
            element.style.color = '#9ca3af';
            check.textContent = '○';
            check.style.borderColor = '#d1d5db';
            check.style.color = '#9ca3af';
        }
    }
    
    // Update on input
    passwordInput.addEventListener('input', updateStrength);
    passwordInput.addEventListener('focus', function() {
        if (this.value.length > 0) {
            strengthIndicator.style.display = 'block';
        }
    });
});
</script>
